name: C++ Build

on:
    push:
        branches: [ "main" ]

jobs:
    build-static-release:
        runs-on: ubuntu-latest

        steps:
        - name: Checkout repository
          uses: actions/checkout@v4     
            
        - name: Install build dependencies
          run: |
            sudo apt update && sudo apt upgrade
            sudo apt install -y make cmake gcc build-essentials git
            git clone https://github.com/microsoft/vcpkg --recursive --depth=1
            cd vcpkg
            ./bootstrap-vcpkg.sh -disableMetrics

        - name: Install vcpkg dependencies
          run: |
            ./vcpkg/vcpkg install curl libzip jsoncpp

        - name: Configure CMake
          run: |
            mkdir build && cd build
            cmake .. -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake -DCMAKE_BUILD_TYPE=Release

        - name: Build project
          run: |
            cd build
            make -j $(nproc)

        - name: Upload artifact
          uses: actions/upload-artifact@v4
          with:
            name: installer-linux-static
            path: build/installer     